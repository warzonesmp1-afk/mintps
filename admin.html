<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
    <h1 class="title">Admin Panel</h1>

    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Code</th>
                <th>Diamonds</th>
                <th>Adjust Diamonds</th>
            </tr>
        </thead>
        <tbody id="userTable"></tbody>
    </table>

    <button onclick="back()">Back to Dashboard</button>
</div>

<script>
let users = JSON.parse(localStorage.getItem("users") || "[]");
const tbody = document.getElementById("userTable");

function renderTable() {
    tbody.innerHTML = "";
    users.forEach(user => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${user.name}</td>
            <td>${user.code}</td>
            <td>${user.diamonds || 0}</td>
            <td>
                <input type="number" id="amt-${user.code}" placeholder="0" style="width:60px">
                <button onclick="adjustDiamonds('${user.code}', true)">Add</button>
                <button onclick="adjustDiamonds('${user.code}', false)">Remove</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}
renderTable();

function adjustDiamonds(code, add) {
    const input = document.getElementById("amt-" + code);
    const amount = parseInt(input.value);
    if(isNaN(amount) || amount <= 0) return alert("Enter a valid amount");

    const user = users.find(u => u.code === code);
    if(user) {
        if(add) user.diamonds = (user.diamonds || 0) + amount;
        else user.diamonds = Math.max(0, (user.diamonds || 0) - amount);
        localStorage.setItem("users", JSON.stringify(users));

        // Update currentUser if admin is adjusting themselves
        const currentUser = JSON.parse(localStorage.getItem("currentUser") || "{}");
        if(currentUser.code === code) {
            currentUser.diamonds = user.diamonds;
            localStorage.setItem("currentUser", JSON.stringify(currentUser));
        }

        alert(`Updated ${user.name}'s diamonds to ${user.diamonds}`);
        renderTable();
        input.value = "";
    }
}

function back() {
    window.location.href = "dashboard.html";
}
</script>
</body>
</html>
if (users.length === 0) {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td colspan="3" style="text-align:center;">No users found</td>`;
    tableBody.appendChild(tr);
} else {
    users.forEach(user => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${user.name}</td>
            <td>${user.code}</td>
            <td>${user.date}</td>
        `;
        tableBody.appendChild(tr);
    });
}

// Logout back to index
function logout() {
    window.location.href = "index.html";
}
</script>

<style>
/* Table Styles */
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}
th, td {
    padding: 12px 8px;
    border-bottom: 1px solid rgba(0,0,0,0.1);
    text-align: left;
    font-weight: 600;
}
thead {
    background: rgba(255,255,255,0.4);
    backdrop-filter: blur(10px);
}
tbody tr:hover {
    background: rgba(255,255,255,0.3);
}
</style>

</body>
</html>
